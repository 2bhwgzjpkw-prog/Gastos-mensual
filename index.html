<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gastos Mensuales</title>

<style>
:root {
  --bg: #0e0e11;
  --card: #1a1a1f;
  --text: #ffffff;
  --muted: #9ca3af;
  --positive: #22c55e;
  --negative: #ef4444;
  --accent: #3b82f6;
}

* {
  box-sizing: border-box;
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
}

body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
  padding: 16px;
}

h1 {
  margin-bottom: 16px;
}

.list {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.card {
  background: var(--card);
  padding: 14px 16px;
  border-radius: 14px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: pointer;
}

.total {
  color: var(--muted);
  font-weight: 600;
}

.total.positive { color: var(--positive); }
.total.negative { color: var(--negative); }

.hidden { display: none; }

.back {
  margin-bottom: 12px;
  color: var(--accent);
  cursor: pointer;
}

.item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: var(--card);
  padding: 12px 14px;
  border-radius: 12px;
}

.amount.positive { color: var(--positive); }
.amount.negative { color: var(--negative); }

.trash {
  cursor: pointer;
  opacity: 0.7;
}

.trash:hover {
  opacity: 1;
}

.fab {
  position: fixed;
  bottom: 24px;
  right: 24px;
  background: var(--accent);
  color: white;
  border-radius: 50%;
  width: 56px;
  height: 56px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 32px;
  cursor: pointer;
}
</style>
</head>

<body>

<div id="monthsView">
  <h1>Meses</h1>
  <div class="list" id="monthsList"></div>
</div>

<div id="detailView" class="hidden">
  <div class="back" onclick="goBack()">‚Üê <span id="monthTitle"></span></div>
  <div class="list" id="itemsList"></div>
  <h2 id="monthTotal"></h2>
</div>

<div class="fab" onclick="addMovement()">+</div>

<script>
const months = [
  "Enero","Febrero","Marzo","Abril","Mayo","Junio",
  "Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"
];

let currentMonth = null;

function getData() {
  return JSON.parse(localStorage.getItem("gastos") || "{}");
}

function saveData(data) {
  localStorage.setItem("gastos", JSON.stringify(data));
}

function formatMoney(value) {
  return value.toLocaleString("es-MX", { style: "currency", currency: "MXN" });
}

function calcTotal(list) {
  return list.reduce((sum, m) => sum + m.amount, 0);
}

function renderMonths() {
  const data = getData();
  const container = document.getElementById("monthsList");
  container.innerHTML = "";

  months.forEach(month => {
    const list = data[month] || [];
    const total = calcTotal(list);

    const div = document.createElement("div");
    div.className = "card";
    div.onclick = () => openMonth(month);

    const totalClass = total >= 0 ? "positive" : "negative";

    div.innerHTML = `
      <span>${month}</span>
      <span class="total ${totalClass}">${formatMoney(total)}</span>
    `;
    container.appendChild(div);
  });
}

function openMonth(month) {
  currentMonth = month;
  document.getElementById("monthsView").classList.add("hidden");
  document.getElementById("detailView").classList.remove("hidden");
  document.getElementById("monthTitle").textContent = month;
  renderMonth();
}

function goBack() {
  currentMonth = null;
  document.getElementById("detailView").classList.add("hidden");
  document.getElementById("monthsView").classList.remove("hidden");
  renderMonths();
}

function renderMonth() {
  const data = getData();
  const list = data[currentMonth] || [];
  const container = document.getElementById("itemsList");
  container.innerHTML = "";

  list.forEach((item, index) => {
    const div = document.createElement("div");
    div.className = "item";

    const cls = item.amount >= 0 ? "positive" : "negative";

    div.innerHTML = `
      <span>${item.name}</span>
      <span class="amount ${cls}">
        ${formatMoney(item.amount)}
        <span class="trash" onclick="deleteItem(${index})">üóëÔ∏è</span>
      </span>
    `;
    container.appendChild(div);
  });

  const total = calcTotal(list);
  document.getElementById("monthTotal").textContent =
    "Total: " + formatMoney(total);
}

function addMovement() {
  if (!currentMonth) return;

  const name = prompt("Concepto:");
  if (!name) return;

  const amount = Number(prompt("Monto (usa - para egresos):"));
  if (isNaN(amount)) return;

  const data = getData();
  if (!data[currentMonth]) data[currentMonth] = [];

  data[currentMonth].push({ name, amount });
  saveData(data);
  renderMonth();
}

function deleteItem(index) {
  const data = getData();
  data[currentMonth].splice(index, 1);
  saveData(data);
  renderMonth();
}

renderMonths();
</script>

</body>
</html>
