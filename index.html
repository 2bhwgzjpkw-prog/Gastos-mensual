<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gastos Personales</title>

<style>
body{
  margin:0;
  background:#0f0f0f;
  color:#fff;
  font-family:-apple-system,BlinkMacSystemFont;
}

header{
  padding:16px;
  border-bottom:1px solid #222;
}

header h1{
  margin:0;
  font-size:20px;
  font-weight:600;
}

.total{
  margin-top:6px;
  font-size:22px;
  font-weight:600;
}

.total.positive{color:#30d158}
.total.negative{color:#ff453a}

.container{
  padding:16px;
}

.form{
  display:grid;
  gap:10px;
  margin-bottom:20px;
}

input,select{
  background:#1c1c1e;
  border:none;
  border-radius:10px;
  padding:12px;
  color:white;
  font-size:16px;
}

button{
  background:#0a84ff;
  border:none;
  border-radius:12px;
  padding:14px;
  font-size:16px;
  color:white;
}

.list{
  display:flex;
  flex-direction:column;
  gap:10px;
}

.item{
  background:#1c1c1e;
  border-radius:12px;
  padding:12px;
  display:grid;
  grid-template-columns:80px 1fr auto auto;
  gap:8px;
  align-items:center;
  cursor:pointer;
}

.date{font-size:13px;color:#aaa}
.desc{font-size:15px}
.amount.ingreso{color:#30d158}
.amount.egreso{color:#ff453a}

.trash{
  font-size:18px;
  cursor:pointer;
}
</style>
</head>

<body>

<header>
  <h1>Gastos personales</h1>
  <div id="total" class="total">$0</div>
</header>

<div class="container">

  <!-- FORMULARIO EN ORDEN NATURAL -->
  <div class="form">
    <input type="date" id="date">
    <input type="number" id="amount" placeholder="Monto">
    <input type="text" id="desc" placeholder="Concepto">

    <select id="type">
      <option value="ingreso">Ingreso</option>
      <option value="egreso">Egreso</option>
    </select>

    <button onclick="saveMovement()">Guardar</button>
  </div>

  <div class="list" id="list"></div>

</div>

<script>
let data = JSON.parse(localStorage.getItem("gastos")) || [];
let editIndex = null;

function formatDate(d){
  const f = new Date(d);
  return f.toLocaleDateString("es-MX",{day:"2-digit",month:"short",year:"2-digit"});
}

function formatMoney(n){
  return n.toLocaleString("es-MX");
}

function save(){
  localStorage.setItem("gastos", JSON.stringify(data));
}

function calcularTotal(){
  let total = 0;
  data.forEach(m=>{
    total += m.type==="ingreso" ? m.amount : -m.amount;
  });

  const el = document.getElementById("total");
  el.textContent = "$" + formatMoney(total);
  el.className = "total " + (total>=0 ? "positive" : "negative");
}

function render(){
  const list = document.getElementById("list");
  list.innerHTML="";

  data.forEach((m,i)=>{
    const div=document.createElement("div");
    div.className="item";
    div.innerHTML=`
      <div class="date">${formatDate(m.date)}</div>
      <div class="desc">${m.desc}</div>
      <div class="amount ${m.type}">
        ${m.type==="ingreso"?"+":"-"}$${formatMoney(m.amount)}
      </div>
      <div class="trash" onclick="remove(${i}); event.stopPropagation()">ðŸ—‘</div>
    `;
    div.onclick = ()=>edit(i);
    list.appendChild(div);
  });

  calcularTotal();
}

function saveMovement(){
  const date=document.getElementById("date").value;
  const amount=document.getElementById("amount").value;
  const desc=document.getElementById("desc").value;
  const type=document.getElementById("type").value;

  if(!date || !amount) return alert("Falta fecha o monto");

  const movement = {
    date,
    amount:Number(amount),
    desc,
    type
  };

  if(editIndex !== null){
    data[editIndex] = movement;
    editIndex = null;
  } else {
    data.unshift(movement);
  }

  clearForm();
  save();
  render();
}

function edit(i){
  const m = data[i];
  document.getElementById("date").value = m.date;
  document.getElementById("amount").value = m.amount;
  document.getElementById("desc").value = m.desc;
  document.getElementById("type").value = m.type;
  editIndex = i;
}

function remove(i){
  data.splice(i,1);
  save();
  render();
}

function clearForm(){
  document.getElementById("amount").value="";
  document.getElementById("desc").value="";
}

render();
</script>

</body>
</html>
