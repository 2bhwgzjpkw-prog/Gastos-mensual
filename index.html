<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gastos Mensuales</title>
<style>
:root {
  --bg: #0d0d0f;
  --card: #1c1c22;
  --text: #ffffff;
  --muted: #9a9a9a;
  --green: #4cd964;
  --red: #ff3b30;
  --blue: #0a84ff;
}

* {
  box-sizing: border-box;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
}

body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
}

header {
  padding: 20px;
  font-size: 24px;
  font-weight: bold;
}

.list {
  padding: 0 16px 90px;
}

.month {
  background: var(--card);
  padding: 14px;
  border-radius: 14px;
  margin-bottom: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: pointer;
}

.month span {
  color: var(--muted);
}

.view {
  display: none;
  padding-bottom: 90px;
}

.view.active {
  display: block;
}

.back {
  padding: 16px;
  font-size: 18px;
  cursor: pointer;
}

.card {
  background: var(--card);
  border-radius: 14px;
  padding: 14px;
  margin: 10px 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.amount.plus { color: var(--green); }
.amount.minus { color: var(--red); }

.trash {
  margin-left: 10px;
  cursor: pointer;
}

.total {
  text-align: right;
  padding: 20px;
  font-size: 20px;
  font-weight: bold;
}

.fab {
  position: fixed;
  right: 20px;
  bottom: 20px;
  background: var(--blue);
  color: white;
  width: 56px;
  height: 56px;
  border-radius: 50%;
  font-size: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}
</style>
</head>
<body>

<header id="title">Meses</header>

<div id="months" class="list"></div>

<div id="detail" class="view">
  <div class="back" onclick="back()">‚Üê <span id="monthName"></span></div>
  <div id="moves"></div>
  <div class="total" id="monthTotal"></div>
</div>

<div class="fab" onclick="addMove()">+</div>

<script>
const months = [
  "Enero","Febrero","Marzo","Abril","Mayo","Junio",
  "Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"
];

let data = JSON.parse(localStorage.getItem("gastos")) || {};
let currentMonth = null;

const monthsDiv = document.getElementById("months");
const detail = document.getElementById("detail");
const movesDiv = document.getElementById("moves");

function format(n) {
  return n.toLocaleString("es-MX", { minimumFractionDigits: 0 });
}

function renderMonths() {
  monthsDiv.innerHTML = "";
  months.forEach(m => {
    const total = (data[m] || []).reduce((s, x) => s + x.amount, 0);
    const div = document.createElement("div");
    div.className = "month";
    div.innerHTML = `<strong>${m}</strong><span>$${format(total)}</span>`;
    div.onclick = () => openMonth(m);
    monthsDiv.appendChild(div);
  });
}

function openMonth(m) {
  currentMonth = m;
  document.getElementById("title").style.display = "none";
  monthsDiv.style.display = "none";
  detail.classList.add("active");
  document.getElementById("monthName").innerText = m;
  renderMoves();
}

function back() {
  detail.classList.remove("active");
  monthsDiv.style.display = "block";
  document.getElementById("title").style.display = "block";
  renderMonths();
}

function renderMoves() {
  movesDiv.innerHTML = "";
  const list = data[currentMonth] || [];
  let total = 0;

  list.forEach((m, i) => {
    total += m.amount;
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <span>${m.text}</span>
      <div>
        <span class="amount ${m.amount >= 0 ? "plus":"minus"}">
          ${m.amount >= 0 ? "+" : ""}$${format(m.amount)}
        </span>
        <span class="trash" onclick="removeMove(${i})">üóëÔ∏è</span>
      </div>
    `;
    movesDiv.appendChild(div);
  });

  document.getElementById("monthTotal").innerText =
    "Total: $" + format(total);
}

function addMove() {
  if (!currentMonth) return;

  const text = prompt("Concepto");
  if (!text) return;

  const amount = parseFloat(prompt("Monto (usa negativo para egreso)"));
  if (isNaN(amount)) return;

  data[currentMonth] = data[currentMonth] || [];
  data[currentMonth].push({ text, amount });

  save();
  renderMoves();
}

function removeMove(i) {
  data[currentMonth].splice(i, 1);
  save();
  renderMoves();
}

function save() {
  localStorage.setItem("gastos", JSON.stringify(data));
}

renderMonths();
</script>

</body>
</html>
