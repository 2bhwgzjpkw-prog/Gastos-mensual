<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gastos mensuales</title>

<style>
body{
  margin:0;
  background:#0f0f0f;
  color:#fff;
  font-family:-apple-system,BlinkMacSystemFont;
}

header{
  padding:16px;
  border-bottom:1px solid #222;
  font-size:20px;
  font-weight:600;
}

.container{
  padding:16px;
}

.month{
  background:#1c1c1e;
  border-radius:12px;
  padding:14px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:10px;
  cursor:pointer;
}

.month span{
  font-size:16px;
}

.month .total.positive{color:#30d158}
.month .total.negative{color:#ff453a}

.annual{
  margin-top:20px;
  padding-top:14px;
  border-top:1px solid #333;
  display:flex;
  justify-content:space-between;
  font-size:18px;
  font-weight:600;
}

.annual.positive{color:#30d158}
.annual.negative{color:#ff453a}

.form{
  display:grid;
  gap:10px;
  margin:20px 0;
}

input,select{
  background:#1c1c1e;
  border:none;
  border-radius:10px;
  padding:12px;
  color:white;
  font-size:16px;
}

button{
  background:#0a84ff;
  border:none;
  border-radius:12px;
  padding:14px;
  font-size:16px;
  color:white;
}

.item{
  background:#1c1c1e;
  border-radius:12px;
  padding:12px;
  display:grid;
  grid-template-columns:90px 1fr auto auto;
  gap:8px;
  align-items:center;
  margin-bottom:8px;
}

.date{font-size:13px;color:#aaa}
.amount.ingreso{color:#30d158}
.amount.egreso{color:#ff453a}
.trash{cursor:pointer}
.back{margin-bottom:10px;color:#0a84ff;cursor:pointer}
</style>
</head>

<body>

<header id="title">Gastos mensuales</header>

<div class="container" id="app"></div>

<script>
const months = [
  "enero","febrero","marzo","abril","mayo","junio",
  "julio","agosto","septiembre","octubre","noviembre","diciembre"
];

let data = JSON.parse(localStorage.getItem("gastosMensuales")) || {};
let currentMonth = null;
let editIndex = null;

months.forEach(m => { if(!data[m]) data[m]=[]; });

function save(){
  localStorage.setItem("gastosMensuales", JSON.stringify(data));
}

function money(n){
  return n.toLocaleString("es-MX");
}

function formatDate(fechaISO){
  const d = new Date(fechaISO);
  return d.toLocaleDateString("es-MX", {
    day: "2-digit",
    month: "2-digit",
    year: "numeric"
  });
}

function monthTotal(m){
  return data[m].reduce((t,x)=>t+(x.type==="ingreso"?x.amount:-x.amount),0);
}

function annualTotal(){
  return months.reduce((sum,m)=>sum+monthTotal(m),0);
}

function renderMonths(){
  const app=document.getElementById("app");
  document.getElementById("title").textContent="Gastos mensuales";
  app.innerHTML="";

  months.forEach(m=>{
    const t=monthTotal(m);
    app.innerHTML+=`
      <div class="month" onclick="openMonth('${m}')">
        <span>${m.charAt(0).toUpperCase()+m.slice(1)}</span>
        <span class="total ${t>=0?'positive':'negative'}">$${money(t)}</span>
      </div>`;
  });

  const totalAnual = annualTotal();
  app.innerHTML+=`
    <div class="annual ${totalAnual>=0?'positive':'negative'}">
      <span>Total anual</span>
      <span>$${money(totalAnual)}</span>
    </div>`;
}

function openMonth(m){
  currentMonth=m;
  editIndex=null;
  document.getElementById("title").textContent=m.toUpperCase();
  const app=document.getElementById("app");

  data[m].sort((a,b)=> new Date(b.date) - new Date(a.date));

  app.innerHTML=`
    <div class="back" onclick="renderMonths()">‚Üê Volver</div>

    <div class="form">
      <input type="date" id="date">
      <input type="number" id="amount" placeholder="Monto">
      <input type="text" id="desc" placeholder="Concepto">
      <select id="type">
        <option value="ingreso">Ingreso</option>
        <option value="egreso">Egreso</option>
      </select>
      <button onclick="saveMovement()">Guardar</button>
    </div>
  `;

  data[m].forEach((x,i)=>{
    app.innerHTML+=`
      <div class="item" onclick="edit(${i})">
        <div class="date">${formatDate(x.date)}</div>
        <div>${x.desc}</div>
        <div class="amount ${x.type}">
          ${x.type==="ingreso"?"+":"-"}$${money(x.amount)}
        </div>
        <div class="trash" onclick="remove(${i});event.stopPropagation()">üóë</div>
      </div>`;
  });
}

function saveMovement(){
  const date=document.getElementById("date").value;
  const amount=+document.getElementById("amount").value;
  const desc=document.getElementById("desc").value;
  const type=document.getElementById("type").value;
  if(!date||!amount) return;

  const m={date,amount,desc,type};

  if(editIndex!==null){
    data[currentMonth][editIndex]=m;
    editIndex=null;
  }else{
    data[currentMonth].push(m);
  }
  save();
  openMonth(currentMonth);
}

function edit(i){
  const m=data[currentMonth][i];
  document.getElementById("date").value=m.date;
  document.getElementById("amount").value=m.amount;
  document.getElementById("desc").value=m.desc;
  document.getElementById("type").value=m.type;
  editIndex=i;
}

function remove(i){
  data[currentMonth].splice(i,1);
  save();
  openMonth(currentMonth);
}

renderMonths();
</script>

</body>
</html>
